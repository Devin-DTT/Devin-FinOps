<!-- Toolbar -->
<mat-toolbar color="primary">
  <span>Devin FinOps Dashboard</span>
  <span class="spacer"></span>
  <span class="connection-indicator" [class.connected]="connectionStatus === 'connected'"
        [class.disconnected]="connectionStatus === 'disconnected'"
        [class.connecting]="connectionStatus === 'connecting'">
    <mat-icon>{{ connectionStatus === 'connected' ? 'wifi' : 'wifi_off' }}</mat-icon>
    {{ connectionStatus | titlecase }}
  </span>
</mat-toolbar>

<div class="dashboard-container">
  <!-- KPI Cards -->
  <div class="kpi-section">
    <mat-card class="kpi-card">
      <mat-card-header>
        <mat-card-title>Total Sessions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <span class="kpi-value">{{ totalSessions }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card kpi-active">
      <mat-card-header>
        <mat-card-title>Active</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <span class="kpi-value">{{ activeSessions }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card kpi-completed">
      <mat-card-header>
        <mat-card-title>Completed</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <span class="kpi-value">{{ completedSessions }}</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card kpi-failed">
      <mat-card-header>
        <mat-card-title>Failed</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <span class="kpi-value">{{ failedSessions }}</span>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Chart Section -->
  <mat-card class="chart-card">
    <mat-card-header>
      <mat-card-title>Active Sessions Over Time</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="chart-container">
        <canvas baseChart
                [data]="lineChartData"
                [options]="lineChartOptions"
                type="line">
        </canvas>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Filter and Table Section -->
  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>Sessions</mat-card-title>
      <span class="spacer"></span>
      <mat-form-field appearance="outline" class="status-filter">
        <mat-label>Filter by Status</mat-label>
        <mat-select [(value)]="selectedStatusFilter" (selectionChange)="onStatusFilterChange()">
          @for (status of statusOptions; track status) {
            <mat-option [value]="status">{{ status | titlecase }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="dataSource" matSort class="sessions-table">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let session">{{ session.id }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let session">
            <mat-chip-set>
              <mat-chip [color]="getStatusColor(session.status)" highlighted>
                {{ session.status | titlecase }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Start Date Column -->
        <ng-container matColumnDef="startDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Start Date</th>
          <td mat-cell *matCellDef="let session">{{ session.startDate | date:'medium' }}</td>
        </ng-container>

        <!-- Duration Column -->
        <ng-container matColumnDef="duration">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Duration</th>
          <td mat-cell *matCellDef="let session">{{ formatDuration(session.duration) }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- No data row -->
        <tr class="mat-row no-data-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            No sessions available
          </td>
        </tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
